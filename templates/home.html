{% extends "base.html" %}
{% block content %}
<section class="hero">
  <p class="tag">Vista viva</p>
  <h1>Panel operativo Kimce</h1>
  <p>
    Supervisa el pulso del estudio, consulta el estado semanal de cada colaborador y abre su
    portal con un clic para registrar marcaciones o solicitudes.
  </p>
</section>
<section class="page-header" style="margin-top:2rem;">
  <div>
    <h2>Colaboradores conectados</h2>
    <p class="page-subtitle">Indicadores semanales en tiempo real</p>
  </div>
</section>
<div class="card-grid">
  {% for item in collaborator_cards %}
  <article class="card">
    <header class="page-header" style="margin-bottom:0.8rem;">
      <div>
        <p class="tag">{{ item.collaborator.collaborator_id }}</p>
        <h3 style="margin:0.3rem 0 0;">{{ item.collaborator.full_name }}</h3>
      </div>
      <span class="indicator-pill {{ item.indicator }}">{{ item.indicator }}</span>
    </header>
    <div class="stat-grid">
      <div class="stat-card">
        <p class="stat-label">Trabajadas</p>
        <p class="stat-value">{{ item.summary.horas_trabajadas|hhmm }}</p>
      </div>
      <div class="stat-card">
        <p class="stat-label">Esperadas</p>
        <p class="stat-value">{{ item.summary.horas_esperadas|hhmm }}</p>
      </div>
      <div class="stat-card">
        <p class="stat-label">Extra</p>
        <p class="stat-value">{{ item.summary.horas_extra|hhmm }}</p>
      </div>
    </div>
    <div style="margin-top:1rem; display:flex; justify-content:space-between; align-items:center; gap:1rem;">
      <p style="margin:0; color:#475569; font-size:0.9rem;">Balance actualizado</p>
      {% if active_collaborator and active_collaborator.collaborator_id == item.collaborator.collaborator_id %}
      <a class="ghost-link" href="/colaborador/{{ item.collaborator.collaborator_id }}">Ir a mi portal →</a>
      {% else %}
      <a class="ghost-link" href="{{ url_for('login') }}?next={{ item.collaborator.collaborator_id }}">Iniciar sesión →</a>
      {% endif %}
    </div>
  </article>
  {% endfor %}
</div>
<section class="page-header" style="margin-top:2.5rem;">
  <div>
    <h2>Salud del equipo</h2>
    <p class="page-subtitle">Balance global y feriados cargados</p>
  </div>
</section>
<section class="card">
  <div class="stat-grid">
    <div class="stat-card">
      <p class="stat-label">Horas a favor</p>
      <p class="stat-value">{{ admin_summary.horas_a_favor|hhmm }}</p>
    </div>
    <div class="stat-card">
      <p class="stat-label">Horas en deuda</p>
      <p class="stat-value">{{ admin_summary.horas_deuda|hhmm }}</p>
    </div>
  </div>
  <h3 style="margin-top:1.5rem;">Feriados configurados</h3>
  {% if holidays %}
  <ul style="list-style:none; padding:0; display:flex; flex-wrap:wrap; gap:0.6rem;">
    {% for holiday in holidays %}
    <li class="tag" style="background:var(--blue-25);">{{ holiday.day }} · {{ holiday.name }}</li>
    {% endfor %}
  </ul>
  {% else %}
  <p style="color:#475569;">No hay feriados cargados aún.</p>
  {% endif %}
</section>
{% endblock %}
