{% extends "base.html" %}
{% block content %}
<div class="page-section">
  <div class="dashboard-main">
    <section class="hero">
      <p class="tag">Mi dashboard</p>
      <h1>Hola, {{ collaborator.full_name }} üëã</h1>
      <p class="page-subtitle">Resumen semanal con accesos directos a tu portal, calendario, solicitudes y perfil.</p>
      <div class="panel-grid" style="margin-top:1rem;">
        <article class="widget clickable" onclick="window.location='{{ url_for('collaborator_view', collaborator_id=collaborator.collaborator_id) }}'">
          <div class="pill-header">
            <div>
              <p class="tag">Horas</p>
              <h3 style="margin:0;">Progreso semanal</h3>
              <p class="quiet-label">{{ summary.horas_trabajadas|hhmm }} / {{ summary.horas_esperadas|hhmm }}</p>
            </div>
            <span class="indicator-pill {{ indicator }}">{{ indicator }}</span>
          </div>
          <div class="stat-grid" style="margin-top:0.8rem;">
            <div class="stat-card">
              <p class="stat-label">Trabajadas</p>
              <p class="stat-value">{{ summary.horas_trabajadas|hhmm }}</p>
            </div>
            <div class="stat-card">
              <p class="stat-label">Esperadas</p>
              <p class="stat-value">{{ summary.horas_esperadas|hhmm }}</p>
            </div>
            <div class="stat-card">
              <p class="stat-label">Horas extra</p>
              <p class="stat-value">{{ summary.horas_extra|hhmm }}</p>
            </div>
            <div class="stat-card">
              <p class="stat-label">Saldo</p>
              <p class="stat-value">{{ balance.horas_a_favor|hhmm }}</p>
            </div>
          </div>
        </article>
        <article class="widget clickable" onclick="window.location='{{ url_for('collaborator_calendar', collaborator_id=collaborator.collaborator_id) }}'" style="display:grid; gap:0.75rem;">
          <div class="pill-header">
            <div>
              <p class="tag">Hoy</p>
              <h3 style="margin:0;">Estado de la jornada</h3>
              <p class="quiet-label">Visualiza tus fichajes y eventos desde el calendario.</p>
            </div>
          </div>
          <div class="chip-row" style="justify-content:space-between;">
            <span>Fecha</span>
            <strong>{{ today.strftime('%d %b %Y') }}</strong>
          </div>
          <div class="stacked-list">
            {% for ev in upcoming_events[:3] %}
            <div class="list-row" style="padding:0.45rem 0.75rem;">
              <div class="list-row__main">
                <p class="tag" style="margin:0;">{{ ev.category }}</p>
                <h4 style="margin:0.2rem 0 0;">{{ ev.title }}</h4>
                <p class="quiet-label">{{ ev.start.strftime('%d/%m %H:%M') }} - {{ ev.end.strftime('%d/%m %H:%M') }}</p>
              </div>
            </div>
            {% else %}
            <p class="quiet-label" style="margin:0;">No tienes eventos pr√≥ximos.</p>
            {% endfor %}
          </div>
          <span class="ghost-link">Abrir calendario ‚Üí</span>
        </article>
      </div>
    </section>

    <div class="widget-grid">
      <article class="widget clickable" onclick="window.location='{{ url_for('collaborator_view', collaborator_id=collaborator.collaborator_id) }}'">
        <div class="pill-header">
          <div>
            <p class="tag">Acciones r√°pidas</p>
            <h3 style="margin:0;">Ir a mi portal</h3>
            <p class="quiet-label">Registrar entrada/salida y descansos.</p>
          </div>
          <span class="ghost-link">Ir al portal ‚Üí</span>
        </div>
        <div class="chip-row" style="justify-content:space-between;">
          <span>Saldo</span>
          <strong>{{ balance.horas_a_favor|hhmm }}</strong>
        </div>
      </article>

      <article class="widget clickable" onclick="window.location='{{ url_for('collaborator_view', collaborator_id=collaborator.collaborator_id) }}#solicitudes'">
        <div class="pill-header">
          <div>
            <p class="tag">Solicitudes</p>
            <h3 style="margin:0;">Pendientes y nuevas</h3>
            <p class="quiet-label">Vacaciones, permisos, horas extra.</p>
          </div>
          <span class="pill-count pending">{{ pending_requests|length }} pendientes</span>
        </div>
        <ul class="clean-list" style="margin-top:0.6rem;">
          {% for req in pending_requests[:3] %}
          <li class="chip-row" style="justify-content:space-between;">{{ req.request_type.value }}<span class="status-chip amber">Pendiente</span></li>
          {% else %}
          <li class="muted">Sin solicitudes pendientes.</li>
          {% endfor %}
        </ul>
      </article>

      <article class="widget clickable" onclick="window.location='{{ url_for('collaborator_profile', collaborator_id=collaborator.collaborator_id) }}'">
        <div class="pill-header">
          <div>
            <p class="tag">Mi perfil</p>
            <h3 style="margin:0;">Datos y documentos</h3>
            <p class="quiet-label">Rol: {{ collaborator.role.value }} ¬∑ Puesto: {{ collaborator.position }}</p>
          </div>
          <span class="ghost-link">Ver perfil ‚Üí</span>
        </div>
        <div class="stat-grid" style="margin-top:0.75rem;">
          <div class="stat-card">
            <p class="stat-label">Modalidad</p>
            <p class="stat-value" style="font-size:1rem;">{{ collaborator.modality.value }}</p>
          </div>
          <div class="stat-card">
            <p class="stat-label">Antig√ºedad</p>
            <p class="stat-value" style="font-size:1rem;">{{ (today - collaborator.start_date).days // 30 }} m</p>
          </div>
          <div class="stat-card">
            <p class="stat-label">√Årea</p>
            <p class="stat-value" style="font-size:1rem;">{{ collaborator.area }}</p>
          </div>
        </div>
      </article>

      <article class="widget">
        <div class="pill-header">
          <div>
            <p class="tag">Notificaciones</p>
            <h3 style="margin:0;">Centro de avisos</h3>
            <p class="quiet-label">√öltimos comunicados y alertas.</p>
          </div>
        </div>
        <ul class="clean-list" style="margin-top:0.75rem;">
          {% for note in notifications[:4] %}
          <li class="notify {{ note.category.value }}" style="margin:0;">{{ note.body }}</li>
          {% else %}
          <li class="muted">Sin notificaciones nuevas.</li>
          {% endfor %}
        </ul>
      </article>
    </div>
  </div>
</div>
{% endblock %}
